Neural Network Tools for STM32AI v1.6.0 (STM.ai v7.3.0-RC5)
Created date          : 2023-01-17 17:02:10
Parameters            : generate --name kws_network -m C:/Users/13588/Desktop/cnn/kws_arm_torch/torch/best_model.onnx --type onnx --compression none --verbosity 1 --workspace C:\Users\13588\AppData\Local\Temp\mxAI_workspace195127029161400733711148637655033 --output C:\Users\13588\.stm32cubemx\network_output --allocate-inputs --allocate-outputs

Exec/report summary (generate)
---------------------------------------------------------------------------------------------------------
model file         :   C:\Users\13588\Desktop\cnn\kws_arm_torch\torch\best_model.onnx                   
type               :   onnx                                                                             
c_name             :   kws_network                                                                      
compression        :   none                                                                             
options            :   allocate-inputs, allocate-outputs                                                
optimization       :   balanced                                                                         
target/series      :   generic                                                                          
workspace dir      :   C:\Users\13588\AppData\Local\Temp\mxAI_workspace195127029161400733711148637655033
output dir         :   C:\Users\13588\.stm32cubemx\network_output                                       
model_fmt          :   float                                                                            
model_name         :   best_model                                                                       
model_hash         :   48c47d921648a380f1253c708d25834e                                                 
params #           :   44,870 items (175.27 KiB)                                                        
---------------------------------------------------------------------------------------------------------
input 1/1          :   'input' (domain:activations/**default**)                                         
                   :   490 items, 1.91 KiB, ai_float, float, (1,49,10,1)                                
output 1/1         :   'output' (domain:activations/**default**)                                        
                   :   6 items, 24 B, ai_float, float, (1,1,1,6)                                        
macc               :   2,650,182                                                                        
weights (ro)       :   179,480 B (175.27 KiB) (1 segment)                                               
activations (rw)   :   48,640 B (47.50 KiB) (1 segment) *                                               
ram (total)        :   48,640 B (47.50 KiB) = 48,640 + 0 + 0                                            
---------------------------------------------------------------------------------------------------------
(*) 'input'/'output' buffers can be used from the activations buffer

Model name - best_model ['input'] ['output']
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
id   layer (type,original)                 oshape                param/size      macc      connected to     |   c_size             c_macc               c_type                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
21   fc1_weight (Placeholder, Gemm)        [h:3840,c:6]          23,040/92,160                              |   +24(+0.0%)         +23,046(+100.0%)     dense_of32[o][10]       
     fc1_bias (Placeholder, Gemm)          [c:6]                 6/24                                       |   -24(-100.0%)                           
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
0    input (Input, )                       [b:1,h:49,w:10,c:1]                                              |                                          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1    x (Conv2D, Conv)                      [b:1,h:24,w:5,c:64]   2,624/10,496    307,264   input            |   -10,496(-100.0%)   -307,264(-100.0%)   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2    input_1 (Nonlinearity, Relu)          [b:1,h:24,w:5,c:64]                   7,680     x                |   +10,496(+100.0%)   +307,264(+4000.8%)   conv2d_of32[0]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
3    x_3 (Conv2D, Conv)                    [b:1,h:24,w:5,c:64]   640/2,560       69,184    input_1          |   -2,560(-100.0%)    -69,184(-100.0%)    
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
4    input_4 (Nonlinearity, Relu)          [b:1,h:24,w:5,c:64]                   7,680     x_3              |   +2,560(+100.0%)    +69,184(+900.8%)     conv2d_of32[1]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
5    x_7 (Conv2D, Conv)                    [b:1,h:24,w:5,c:64]   4,160/16,640    491,584   input_4          |   -16,640(-100.0%)   -491,584(-100.0%)   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
6    input_8 (Nonlinearity, Relu)          [b:1,h:24,w:5,c:64]                   7,680     x_7              |   +16,640(+100.0%)   +491,584(+6400.8%)   conv2d_of32[2]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
7    x_11 (Conv2D, Conv)                   [b:1,h:24,w:5,c:64]   640/2,560       69,184    input_8          |   -2,560(-100.0%)    -69,184(-100.0%)    
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
8    input_12 (Nonlinearity, Relu)         [b:1,h:24,w:5,c:64]                   7,680     x_11             |   +2,560(+100.0%)    +69,184(+900.8%)     conv2d_of32[3]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
9    x_15 (Conv2D, Conv)                   [b:1,h:24,w:5,c:64]   4,160/16,640    491,584   input_12         |   -16,640(-100.0%)   -491,584(-100.0%)   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
10   input_16 (Nonlinearity, Relu)         [b:1,h:24,w:5,c:64]                   7,680     x_15             |   +16,640(+100.0%)   +491,584(+6400.8%)   conv2d_of32[4]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
11   x_19 (Conv2D, Conv)                   [b:1,h:24,w:5,c:64]   640/2,560       69,184    input_16         |   -2,560(-100.0%)    -69,184(-100.0%)    
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
12   input_20 (Nonlinearity, Relu)         [b:1,h:24,w:5,c:64]                   7,680     x_19             |   +2,560(+100.0%)    +69,184(+900.8%)     conv2d_of32[5]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
13   x_23 (Conv2D, Conv)                   [b:1,h:24,w:5,c:64]   4,160/16,640    491,584   input_20         |   -16,640(-100.0%)   -491,584(-100.0%)   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
14   input_24 (Nonlinearity, Relu)         [b:1,h:24,w:5,c:64]                   7,680     x_23             |   +16,640(+100.0%)   +491,584(+6400.8%)   conv2d_of32[6]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
15   x_27 (Conv2D, Conv)                   [b:1,h:24,w:5,c:64]   640/2,560       69,184    input_24         |   -2,560(-100.0%)    -69,184(-100.0%)    
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
16   input_28 (Nonlinearity, Relu)         [b:1,h:24,w:5,c:64]                   7,680     x_27             |   +2,560(+100.0%)    +69,184(+900.8%)     conv2d_of32[7]          
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
17   x_31 (Conv2D, Conv)                   [b:1,h:24,w:5,c:64]   4,160/16,640    491,584   input_28         |   -16,640(-100.0%)   -491,584(-100.0%)   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
18   onnxMaxPool_26 (Nonlinearity, Relu)   [b:1,h:24,w:5,c:64]                   7,680     x_31             |                      -7,680(-100.0%)     
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
19   onnxReshape_27 (Pool, MaxPool)        [b:1,h:12,w:5,c:64]                   7,680     onnxMaxPool_26   |   +16,640(+100.0%)   +499,264(+6500.8%)   optimized_conv2d_of32[8]
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
20   onnxGemm_29 (Reshape, Reshape)        [b:1,c:3840]                                    onnxReshape_27   |                                           transpose_of32[9]       
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
21   output (Gemm, Gemm)                   [b:1,c:6]                             23,046    onnxGemm_29      |                      -23,046(-100.0%)    
                                                                                           fc1_weight       |  
                                                                                           fc1_bias         |  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
model/c-model: macc=2,650,182/2,650,182  weights=179,480/179,480  activations=--/48,640 io=--/0



Generated C-graph summary
------------------------------------------------------------------------------------------------------------------------
model name            : best_model
c-name                : kws_network
c-node #              : 11
c-array #             : 33
activations size      : 48640 (1 segment)
weights size          : 179480 (1 segment)
macc                  : 2650182
inputs                : ['input_output']
outputs               : ['output_output']

C-Arrays (33)
--------------------------------------------------------------------------------------------------------------
c_id   name (*_array)                 item/size     domain/mem-pool           c-type        fmt       comment
--------------------------------------------------------------------------------------------------------------
0      x_weights                      2560/10240    weights/weights           const float   float32          
1      x_bias                         64/256        weights/weights           const float   float32          
2      x_3_weights                    576/2304      weights/weights           const float   float32          
3      x_3_bias                       64/256        weights/weights           const float   float32          
4      x_7_weights                    4096/16384    weights/weights           const float   float32          
5      x_7_bias                       64/256        weights/weights           const float   float32          
6      x_11_weights                   576/2304      weights/weights           const float   float32          
7      x_11_bias                      64/256        weights/weights           const float   float32          
8      x_15_weights                   4096/16384    weights/weights           const float   float32          
9      x_15_bias                      64/256        weights/weights           const float   float32          
10     x_19_weights                   576/2304      weights/weights           const float   float32          
11     x_19_bias                      64/256        weights/weights           const float   float32          
12     x_23_weights                   4096/16384    weights/weights           const float   float32          
13     x_23_bias                      64/256        weights/weights           const float   float32          
14     x_27_weights                   576/2304      weights/weights           const float   float32          
15     x_27_bias                      64/256        weights/weights           const float   float32          
16     x_31_weights                   4096/16384    weights/weights           const float   float32          
17     x_31_bias                      64/256        weights/weights           const float   float32          
18     output_weights                 23040/92160   weights/weights           const float   float32          
19     input_output                   490/1960      activations/**default**   float         float32   /input 
20     output_bias                    6/24          weights/weights           const float   float32          
21     x_output                       7680/30720    activations/**default**   float         float32          
22     x_3_output                     7680/30720    activations/**default**   float         float32          
23     x_7_output                     7680/30720    activations/**default**   float         float32          
24     x_31_scratch0                  640/2560      activations/**default**   float         float32          
25     x_11_output                    7680/30720    activations/**default**   float         float32          
26     x_15_output                    7680/30720    activations/**default**   float         float32          
27     x_19_output                    7680/30720    activations/**default**   float         float32          
28     x_23_output                    7680/30720    activations/**default**   float         float32          
29     x_27_output                    7680/30720    activations/**default**   float         float32          
30     x_31_output                    3840/15360    activations/**default**   float         float32          
31     onnxGemm_29_to_chlast_output   3840/15360    activations/**default**   float         float32          
32     output_output                  6/24          activations/**default**   float         float32   /output
--------------------------------------------------------------------------------------------------------------

C-Layers (11)
------------------------------------------------------------------------------------------------------------------------------
c_id   name (*_layer)          id   layer_type          macc     rom     tensors                            shape (array id) 
------------------------------------------------------------------------------------------------------------------------------
0      x                       2    conv2d              314944   10496   I: input_output                    (1,49,10,1) (19) 
                                                                         W: x_weights                       (1,64,4,10) (0)  
                                                                         W: x_bias                          (1,1,1,64) (1)   
                                                                         O: x_output                        (1,24,5,64) (21) 
------------------------------------------------------------------------------------------------------------------------------
1      x_3                     4    conv2d              76864    2560    I: x_output                        (1,24,5,64) (21) 
                                                                         W: x_3_weights                     (1,64,3,3) (2)   
                                                                         W: x_3_bias                        (1,1,1,64) (3)   
                                                                         O: x_3_output                      (1,24,5,64) (22) 
------------------------------------------------------------------------------------------------------------------------------
2      x_7                     6    conv2d              499264   16640   I: x_3_output                      (1,24,5,64) (22) 
                                                                         W: x_7_weights                     (64,64,1,1) (4)  
                                                                         W: x_7_bias                        (1,1,1,64) (5)   
                                                                         O: x_7_output                      (1,24,5,64) (23) 
------------------------------------------------------------------------------------------------------------------------------
3      x_11                    8    conv2d              76864    2560    I: x_7_output                      (1,24,5,64) (23) 
                                                                         W: x_11_weights                    (1,64,3,3) (6)   
                                                                         W: x_11_bias                       (1,1,1,64) (7)   
                                                                         O: x_11_output                     (1,24,5,64) (25) 
------------------------------------------------------------------------------------------------------------------------------
4      x_15                    10   conv2d              499264   16640   I: x_11_output                     (1,24,5,64) (25) 
                                                                         W: x_15_weights                    (64,64,1,1) (8)  
                                                                         W: x_15_bias                       (1,1,1,64) (9)   
                                                                         O: x_15_output                     (1,24,5,64) (26) 
------------------------------------------------------------------------------------------------------------------------------
5      x_19                    12   conv2d              76864    2560    I: x_15_output                     (1,24,5,64) (26) 
                                                                         W: x_19_weights                    (1,64,3,3) (10)  
                                                                         W: x_19_bias                       (1,1,1,64) (11)  
                                                                         O: x_19_output                     (1,24,5,64) (27) 
------------------------------------------------------------------------------------------------------------------------------
6      x_23                    14   conv2d              499264   16640   I: x_19_output                     (1,24,5,64) (27) 
                                                                         W: x_23_weights                    (64,64,1,1) (12) 
                                                                         W: x_23_bias                       (1,1,1,64) (13)  
                                                                         O: x_23_output                     (1,24,5,64) (28) 
------------------------------------------------------------------------------------------------------------------------------
7      x_27                    16   conv2d              76864    2560    I: x_23_output                     (1,24,5,64) (28) 
                                                                         W: x_27_weights                    (1,64,3,3) (14)  
                                                                         W: x_27_bias                       (1,1,1,64) (15)  
                                                                         O: x_27_output                     (1,24,5,64) (29) 
------------------------------------------------------------------------------------------------------------------------------
8      x_31                    19   optimized_conv2d    506944   16640   I: x_27_output                     (1,24,5,64) (29) 
                                                                         S: x_31_scratch0                                    
                                                                         W: x_31_weights                    (64,64,1,1) (16) 
                                                                         W: x_31_bias                       (1,1,1,64) (17)  
                                                                         O: x_31_output                     (1,12,5,64) (30) 
------------------------------------------------------------------------------------------------------------------------------
9      onnxGemm_29_to_chlast   20   transpose           0        0       I: x_31_output                     (1,12,5,64) (30) 
                                                                         O: onnxGemm_29_to_chlast_output    (1,64,12,5) (31) 
------------------------------------------------------------------------------------------------------------------------------
10     output                  21   dense               23046    92184   I: onnxGemm_29_to_chlast_output0   (1,1,1,3840) (31)
                                                                         W: output_weights                  (3840,1,1,6) (18)
                                                                         W: output_bias                     (1,1,1,6) (20)   
                                                                         O: output_output                   (1,1,1,6) (32)   
------------------------------------------------------------------------------------------------------------------------------



Number of operations per c-layer
------------------------------------------------------------------------------------------------------------
c_id    m_id   name (type)                         #op (type)                       #param (sparsity)      
------------------------------------------------------------------------------------------------------------
0       2      x (conv2d)                                  314,944 (smul_f32_f32)            2,624 (0.0000)
1       4      x_3 (conv2d)                                 76,864 (smul_f32_f32)              640 (0.0000)
2       6      x_7 (conv2d)                                499,264 (smul_f32_f32)            4,160 (0.0000)
3       8      x_11 (conv2d)                                76,864 (smul_f32_f32)              640 (0.0000)
4       10     x_15 (conv2d)                               499,264 (smul_f32_f32)            4,160 (0.0000)
5       12     x_19 (conv2d)                                76,864 (smul_f32_f32)              640 (0.0000)
6       14     x_23 (conv2d)                               499,264 (smul_f32_f32)            4,160 (0.0000)
7       16     x_27 (conv2d)                                76,864 (smul_f32_f32)              640 (0.0000)
8       19     x_31 (optimized_conv2d)                     506,944 (smul_f32_f32)            4,160 (0.0000)
9       20     onnxGemm_29_to_chlast (transpose)                 0 (smul_f32_f32)                          
10      21     output (dense)                               23,046 (smul_f32_f32)           23,046 (0.0000)
------------------------------------------------------------------------------------------------------------
total                                                    2,650,182                          44,870 (0.0000)

  Number of operation types
  ---------------------------------------------
  smul_f32_f32           2,650,182      100.0%

Complexity report (model)
---------------------------------------------------------------------------------
m_id   name             c_macc                    c_rom                     c_id
---------------------------------------------------------------------------------
21     fc1_weight       |                  0.9%   ||||||||||||||||  51.4%   [10]
2      input_1          ||||||||||        11.9%   ||                 5.8%   [0] 
4      input_4          |||                2.9%   |                  1.4%   [1] 
6      input_8          |||||||||||||||   18.8%   |||                9.3%   [2] 
8      input_12         |||                2.9%   |                  1.4%   [3] 
10     input_16         |||||||||||||||   18.8%   |||                9.3%   [4] 
12     input_20         |||                2.9%   |                  1.4%   [5] 
14     input_24         |||||||||||||||   18.8%   |||                9.3%   [6] 
16     input_28         |||                2.9%   |                  1.4%   [7] 
19     onnxReshape_27   ||||||||||||||||  19.1%   |||                9.3%   [8] 
20     onnxGemm_29      |                  0.0%   |                  0.0%   [9] 
---------------------------------------------------------------------------------
macc=2,650,182 weights=179,480 act=48,640 ram_io=0

Generated files (7)
------------------------------------------------------------------------------
C:\Users\13588\.stm32cubemx\network_output\kws_network_config.h
C:\Users\13588\.stm32cubemx\network_output\kws_network.h
C:\Users\13588\.stm32cubemx\network_output\kws_network.c
C:\Users\13588\.stm32cubemx\network_output\kws_network_data_params.h
C:\Users\13588\.stm32cubemx\network_output\kws_network_data_params.c
C:\Users\13588\.stm32cubemx\network_output\kws_network_data.h
C:\Users\13588\.stm32cubemx\network_output\kws_network_data.c
